# 第三章 处理机调度与死锁
## 3.1
### 3.1.0 作业和进程
- 作业：用户向计算机提交任务的**任务实体**
- 进程：完成用户任务的**执行实体**

> 没有作业，进程无事可干；没有进程，作业任务无法完成。
- 作业建立完毕，总在外存等待；进程总有一部分在内存

- 作业调度：使作业进入主存储器
- 进程调度：是作业进程占用处理器

### 3.1.1 处理机的层次
#### 高级调度（作业调度）
- 调度对象：作业
- 功能：
- 接纳多少作业？ 接纳那些作业？
- 场景：
  - 批处理 yes
  - 分时系统 no
  - 实时系统 no

#### 低级调度（进程调度）
- 特点：频率很高
- 功能：
  - 保存处理机的现场信息
  - 按某种算法选取进程
  - 把处理机分配给进程
- 场景：三种OS里都有
- 3个基本机制
  - 排队器
  - 分派器
  - 上下文切换器
- 2种方式
  - 引发因素(3点)
  - 非剥夺调度方式：实现简单，开销小；不适于紧急任务。
  - 剥夺调度方式：适用于紧急任务；分时/实时系统
    - 优先权原则
    - 时间片原则
    - 短作业优先原则
#### 中级调度（内存调度）
- 等待队列过长，放入外存挂起；再放回内存

#### 调度队列模型
##### 仅有进程调度
- 就绪队列形式：FIFO


##### 具有高级和低级调度
- 就绪队列形式：优先权队列形式
- 设置多个阻塞队列

##### 同时具有三级调度

#### 进程调度的时机

### 3.1.2 调度算法评价和指标
- CPU利用率
- 系统吞吐量 = 总共完成多少作业 / 总的运行时间
- 周转时间 = 作业完成时间 - 作业提交时间
- 带权周转时间 = （作业完成时间 - 作业提交时间）/ 作业实际运行时间
- 平均带权周转时间 = 各作业带权周转时间之和 / 作业数
- 响应时间

## 3.2 调度算法
### 作业（进程）调度
- 批处理系统：短作业优先
- 分时系统：时间片流转

#### 先来先服务 FCFS
- 适用：作业/进程调度
- 作业：先到先得
- 进程：

#### 短作业（进程）优先调度算法 （SJ(P)F）
- 适用：作业/进程调度
- 作业：运行时间端的作业,优先调入内存运行。
- 进程：运行事件端的进程，先分配处理机

#### 高响应比优先调度算法 （HRRN，Highest Response Ratio Next）
- 优先级 = （等待时间+要求服务时间）/要求服务时间
- 响应比 = （等待时间+要求服务时间）/要求服务时间 = 响应时间/要求服务时间

#### 时间片轮转法
- 正常FCFS，时间片内未运行完，转回就绪态插入就绪队列...
- 时间片大小的确定
  - 略大于一次...
- 非抢占
- 无缓急处理

#### 优先级调度算法
- 非抢占式：
  - 适用：批处理系统
  - 优点：满足紧迫作业
- 抢占式：
  - 选择优先级最高的，可打断。先来先运行

优先级的类型：
- 静态优先级
- 优先级（大高/小高）
- 确定优先级的依据
  - 进程类型：系统进程 > 用户进程
  - 进程对资源的需求
  - 用户要求    

#### 多级反馈队列调度算法（调度机制要背！！！其他可以不背）
- 多个就绪队列，第1个就绪队列在时间片没有运行完，则放入就绪队列2，以此类推...一直到最后一个就绪队列。
- 能较好满足各种类型进程的需要。

## 3.3 死锁
> 死锁至少需要两个进程。
> 错误：所有情况都可能出现死锁。

- 死锁：卡死
- 饥饿：长期等不到

### 产生死锁的原因
- 竞争资源
- 进程推进顺序不当


#### 竞争资源引起进程死锁
资源分类：
- 可抢占资源：CPU、主存（不会发生死锁）
- 不可抢占性资源：打印机（会发生死锁）

引起死锁的原因
- 竞争不可抢占性资源
- 竞争临时性资源

#### 进程推进顺序不当
- 进程推进顺序合法
- 进程推进顺序不合法

### 产生死锁的必要条件（非常重要！！！）
- 互斥条件
- 请求和保持条件
- 不剥夺条件
- 环路等待条件

### 处理死锁的基本方法
- 预防死锁：较严格，破坏2，3，4条件
- 避免死锁（**银行家算法**）：较宽松
- 死锁的检测
- 死锁接触

#### 预防死锁
- 一般破坏2，3，4条件

破坏“请求和保持”条件
- 原：源资源不释放，同时请求新资源(得不到的大家都得不到)
- 第一种协议：运行前一次性申请完所有资源
  - 优：简单、安全
  - 缺：资源浪费严重，进程易延迟
- 第二种协议：只运行最初
  - 优：...

破坏不可抢占资源
- 新资源拿不到，立即释放所有资源（得不到，让大家得到）
- 缺：
  - 复杂
  - 仅对易保存资源使用
  - 增加系统开销，降低系统吞吐量
  - 导致饥饿

破坏循环等待
- 顺序资源分配法：必须按编号递增的顺序请求资源。（从小到大申请）

#### 避免死锁
- 安全状态：一定不是死锁
- 不安全状态：可能进入，但不是一定是死锁

银行家算法 p112

安全性算法
- Work变量
- Finish变量

### 死锁检测与接触
#### 死锁检测
**死锁定理**（容易考！！）
- 是充分条件

